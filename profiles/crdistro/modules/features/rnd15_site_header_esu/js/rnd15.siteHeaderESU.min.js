(function(d){Drupal.behaviors.rnd15siteHeaderESU={defaults:{mainNavClass:"nav.nav",toggleButtonClass:"button.button-esu--toggle",siteHeaderESUClass:"div.esu-header",siteHeaderESUBlockTitleClass:".esu-header__title.block__title",siteHeaderESUCloseButtonClass:"a.esu-header__close",mainNavTouchClass:"nav--touch",expandedOpenClass:"open",errorMessageClass:"messages--error",errorClass:"error",previousStep:null,currentStep:"step1",hasError:!1,formSteps:{step1:"cr-marketing-prefs-header-form-general",step2:"cr-marketing-prefs-header-form-teacher",
step3:"cr-marketing-prefs-header-form-complete"},transitionOverflowDelay:1200,$navSite:null,$errorMessages:null,errorTextMessage:"",$toggleButton:null,$siteHeaderESUBlockTitle:null,$siteHeaderESUBlock:null,$siteHeaderESUCloseButton:null,esuCollapsed:!0},attach:function(a,b){var c=Drupal.behaviors.rnd15siteHeaderESU;d(c.defaults.siteHeaderESUClass,a).once("rnd15siteHeaderESU",c.setupESU);Drupal.settings.rnd15siteHeaderESU&&c.processContext(a)},setupESU:function(a){var b=Drupal.behaviors.rnd15siteHeaderESU;
Drupal.settings.rnd15siteHeaderESU=d.extend({},b.defaults);var c=Drupal.settings.rnd15siteHeaderESU;c.$navSite=d(c.mainNavClass,a);c.$toggleButton=d(c.toggleButtonClass,c.$navSite);c.$siteHeaderESUBlock=d(c.siteHeaderESUClass,a);c.$siteHeaderESUCloseButton=d(c.siteHeaderESUCloseButtonClass,a);b.setupsiteHeaderESUMenu(a)},processContext:function(a){a=d(a);var b=Drupal.behaviors.rnd15siteHeaderESU,c=Drupal.settings.rnd15siteHeaderESU;c.hasError=!1;if(a.hasClass(b.defaults.errorMessageClass))a.once("siteHeaderESU",
b.handleErrors);if(a.hasClass(b.defaults.formSteps.step2)||a.hasClass(b.defaults.formSteps.step3)||c.hasError)a.once("steps",b.handleSteps)},handleSteps:function(){var a=Drupal.behaviors.rnd15siteHeaderESU,b=Drupal.settings.rnd15siteHeaderESU;a.setActiveStep.call(this);(null!==b.previousStep&&b.previousStep!==b.currentStep||b.hasError)&&a.trackESU()},handleErrors:function(){var a=Drupal.settings.rnd15siteHeaderESU;if(d(this).parents(a.siteHeaderESUClass).length){a.$errorMessages=d(this);var b=d('input[type="submit"]',
a.$siteHeaderESUBlock);a.hasError=a.$errorMessages.text();a.hasError=a.hasError.replace("Error message","");a.$errorMessages.insertAfter(b)}},setupsiteHeaderESUMenu:function(a){a=Drupal.behaviors.rnd15siteHeaderESU;var b=Drupal.settings.rnd15siteHeaderESU;b.$toggleButton.on("click",a.EH_toggleESU);b.$siteHeaderESUCloseButton.on("click",a.EH_toggleESU)},EH_toggleESU:function(a,b){var c=Drupal.behaviors.rnd15siteHeaderESU,f=Drupal.behaviors.rnd15touchMenu,e=Drupal.settings.rnd15siteHeaderESU;a.preventDefault();
e.$siteHeaderESUBlock=d(e.siteHeaderESUClass);e.$toggleButton=d(e.toggleButtonClass,e.$navSite);e.esuCollapsed=e.$siteHeaderESUBlock.hasClass(e.expandedOpenClass);e.$siteHeaderESUBlock.toggleClass(e.expandedOpenClass);e.esuCollapsed?(e.$siteHeaderESUBlock.removeClass("opened"),c.resetErrors()):e.$siteHeaderESUBlock.delay(e.transitionOverflowDelay).queue(function(a){d(this).addClass("opened");a()});e.$toggleButton.toggleClass("active");"closeAll"!==b&&f.closeNavButtons.apply(e.$toggleButton)},resetErrors:function(){var a=
Drupal.settings.rnd15siteHeaderESU,b=d(a.siteHeaderESUClass);d("."+a.errorMessageClass,b).hide();d("."+a.errorClass,b).removeClass(a.errorClass)},setActiveStep:function(){var a=Drupal.settings.rnd15siteHeaderESU,b="",c;for(c in a.formSteps)b=a.formSteps[c],d(this).hasClass(b)&&(a.previousStep=a.currentStep,a.currentStep=c)},trackESU:function(){if(dataLayer){var a=Drupal.settings.rnd15siteHeaderESU,b={event:"rnd15.esuHeader",activeStep:String(a.currentStep),previousStep:String(a.previousStep)};a.hasError&&
(b.error=String(a.hasError));dataLayer.push(b)}}}})(jQuery);