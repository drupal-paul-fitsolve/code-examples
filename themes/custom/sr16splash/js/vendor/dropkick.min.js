(function(f,k,q){f.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);f.isIframe=f.parent!=f.self&&location.host===parent.location.host;var g=[],h=function(a,b){var c;if(f.isMobile&&!b.mobile)return!1;if(this===f)return new h(a,b);"string"===typeof a&&"#"===a[0]&&(a=k.getElementById(a.substr(1)));if(c=a.getAttribute("data-dkcacheid"))return e.extend(g[c].data.settings,b),g[c];if("SELECT"===a.nodeName)return this.init(a,b)},n=function(){},r={initialize:n,
change:n,open:n,close:n,search:"strict"},e={hasClass:function(a,b){var c=new RegExp("(^|\\s+)"+b+"(\\s+|$)");return a&&c.test(a.className)},addClass:function(a,b){a&&!e.hasClass(a,b)&&(a.className+=" "+b)},removeClass:function(a,b){var c=new RegExp("(^|\\s+)"+b+"(\\s+|$)");a&&(a.className=a.className.replace(c," "))},toggleClass:function(a,b){var c=e.hasClass(a,b)?"remove":"add";e[c+"Class"](a,b)},extend:function(a){Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)a[c]=
b[c]});return a},offset:function(a){a=a.getBoundingClientRect()||{top:0,left:0};var b=k.documentElement;return{top:a.top+f.pageYOffset-b.clientTop,left:a.left+f.pageXOffset-b.clientLeft}},position:function(a,b){for(var c={top:0,left:0};a!==b;)c.top+=a.offsetTop,c.left+=a.offsetLeft,a=a.parentNode;return c},closest:function(a,b){for(;a;){if(a===b)return a;a=a.parentNode}return!1},create:function(a,b){var c,d=k.createElement(a);b||(b={});for(c in b)b.hasOwnProperty(c)&&("innerHTML"==c?d.innerHTML=b[c]:
d.setAttribute(c,b[c]));return d}};h.prototype={add:function(a,b){var c,d;"string"===typeof a&&(c=a,a=k.createElement("option"),a.text=c);"OPTION"===a.nodeName&&(c=e.create("li",{"class":"dk-option","data-value":a.value,innerHTML:a.text,role:"option","aria-selected":"false",id:"dk"+this.data.cacheID+"-"+(a.id||a.value.replace(" ","-"))}),e.addClass(c,a.className),this.length+=1,a.disabled&&(e.addClass(c,"dk-option-disabled"),c.setAttribute("aria-disabled","true")),this.data.select.add(a,b),"number"===
typeof b&&(b=this.item(b)),-1<this.options.indexOf(b)?b.parentNode.insertBefore(c,b):this.data.elem.lastChild.appendChild(c),c.addEventListener("mouseover",this),d=this.options.indexOf(b),this.options.splice(d,0,c),a.selected&&this.select(d))},item:function(a){a=0>a?this.options.length+a:a;return this.options[a]||null},remove:function(a){var b=this.item(a);b.parentNode.removeChild(b);this.options.splice(a,1);this.data.select.remove(a);this.select(this.data.select.selectedIndex);--this.length},init:function(a,
b){var c;c=h.build(a,"dk"+g.length);this.data={};this.data.select=a;this.data.elem=c.elem;this.data.settings=e.extend({},r,b);this.disabled=a.disabled;this.form=a.form;this.length=a.length;this.multiple=a.multiple;this.options=c.options.slice(0);this.selectedIndex=a.selectedIndex;this.selectedOptions=c.selected.slice(0);this.value=a.value;a.parentNode.insertBefore(this.data.elem,a);this.data.elem.addEventListener("click",this);this.data.elem.addEventListener("keydown",this);this.data.elem.addEventListener("keypress",
this);this.form&&this.form.addEventListener("reset",this);if(!this.multiple)for(c=0;c<this.options.length;c++)this.options[c].addEventListener("mouseover",this);0===g.length&&(k.addEventListener("click",h.onDocClick),f.isIframe&&parent.document.addEventListener("click",h.onDocClick));this.data.cacheID=g.length;a.setAttribute("data-dkCacheId",this.data.cacheID);g.push(this);this.data.settings.initialize.call(this);return this},close:function(){var a=this.data.elem;if(!this.isOpen||this.multiple)return!1;
for(i=0;i<this.options.length;i++)e.removeClass(this.options[i],"dk-option-highlight");a.lastChild.setAttribute("aria-expanded","false");e.removeClass(a.lastChild,"dk-select-options-highlight");e.removeClass(a,"dk-select-open-(up|down)");this.isOpen=!1;this.data.settings.close.call(this)},open:function(){var a,b=this.data.elem,c=b.lastChild,d=e.offset(b).top-f.scrollY,t=f.innerHeight-(d+b.offsetHeight);if(this.isOpen||this.multiple)return!1;c.style.display="block";a=c.offsetHeight;c.style.display=
"";direction=d>a&&!(t>a)?"-up":"-down";this.isOpen=!0;e.addClass(b,"dk-select-open"+direction);c.setAttribute("aria-expanded","true");this._scrollTo(this.options.length-1);this._scrollTo(this.selectedIndex);this.data.settings.open.call(this)},disable:function(a,b){var c="dk-option-disabled";if(0==arguments.length||"boolean"===typeof a)b=a===q?!0:!1,a=this.data.elem,c="dk-select-disabled",this.disabled=b;b==q&&(b=!0);"number"===typeof a&&(a=this.item(a));e[b?"addClass":"removeClass"](a,c)},select:function(a,
b){var c,d,f=this.data.select;"number"===typeof a&&(a=this.item(a));if(!b&&e.hasClass(a,"dk-option-disabled"))return!1;if(e.hasClass(a,"dk-option"))return c=this.options.indexOf(a),c=f.options[c],this.multiple?(e.toggleClass(a,"dk-option-selected"),c.selected=!c.selected,e.hasClass(a,"dk-option-selected")?(a.setAttribute("aria-selected","true"),this.selectedOptions.push(a)):(a.setAttribute("aria-selected","false"),c=this.selectedOptions.indexOf(a),this.selectedOptions.splice(c,1))):(d=this.data.elem.firstChild,
this.selectedOptions.length&&(e.removeClass(this.selectedOptions[0],"dk-option-selected"),this.selectedOptions[0].setAttribute("aria-selected","false")),e.addClass(a,"dk-option-selected"),a.setAttribute("aria-selected","true"),d.setAttribute("aria-activedescendant",a.id),d.innerHTML=c.text,this.selectedOptions[0]=a,c.selected=!0),this.selectedIndex=f.selectedIndex,this.value=f.value,this.data.settings.change.call(this),a},selectOne:function(a,b){this.reset(!0);this._scrollTo(a);return this.select(a,
b)},search:function(a,b){var c,d,e,f,g,l,p,h,k=this.data.select.options,m=[];if(!a)return this.options;b=b?b.toLowerCase():"strict";b="fuzzy"==b?2:"partial"==b?1:0;h=new RegExp((b?"":"^")+a,"i");for(c=0;c<k.length;c++)if(e=k[c].text.toLowerCase(),2==b){d=a.toLowerCase().split("");for(f=g=l=p=0;g<e.length;)e[g]===d[f]?(l+=1+l,f++):l=0,p+=l,g++;f==d.length&&m.push({e:this.options[c],s:p,i:c})}else h.test(e)&&m.push(this.options[c]);2==b&&(m=m.sort(function(a,b){return b.s-a.s||a.i-b.i}).reduce(function(a,
b){a[a.length]=b.e;return a},[]));return m},reset:function(a){var b,c=this.data.select;for(b=this.selectedOptions.length=0;b<c.options.length;b++)c.options[b].selected=!1,e.removeClass(this.options[b],"dk-option-selected"),this.options[b].setAttribute("aria-selected","false"),!a&&c.options[b].defaultSelected&&this.select(b,!0);this.selectedOptions.length||this.multiple||this.select(0,!0)},refresh:function(){g.splice(this.data.cacheID,1);this.data.elem.parentNode.removeChild(this.data.elem);this.init(this.data.select,
this.data.settings)},handleEvent:function(a){if(!this.disabled)switch(a.type){case "click":this._delegate(a);break;case "keydown":this._keyHandler(a);break;case "keypress":this._searchOptions(a);break;case "mouseover":this._highlight(a);break;case "reset":this.reset()}},_delegate:function(a){var b,c;c=a.target;if(e.hasClass(c,"dk-option-disabled"))return!1;if(!this.multiple)this[this.isOpen?"close":"open"](),e.hasClass(c,"dk-option")&&this.select(c);else if(e.hasClass(c,"dk-option"))if(b=f.getSelection(),
"Range"==b.type&&b.collapseToStart(),a.shiftKey)if(a=this.options.indexOf(this.selectedOptions[0]),b=this.options.indexOf(this.selectedOptions[this.selectedOptions.length-1]),c=this.options.indexOf(c),c>a&&c<b&&(c=a),c>b&&b>a&&(b=a),this.reset(!0),b>c)for(;c<b+1;)this.select(c++);else for(;c>b-1;)this.select(c--);else a.ctrlKey||a.metaKey||this.reset(!0),this.select(c)},_highlight:function(a){var b=a.target;if(!this.multiple){for(a=0;a<this.options.length;a++)e.removeClass(this.options[a],"dk-option-highlight");
e.addClass(this.data.elem.lastChild,"dk-select-options-highlight");e.addClass(b,"dk-option-highlight")}},_keyHandler:function(a){var b=this.selectedOptions,c=this.options,d=1;switch(a.keyCode){case 38:d=-1;case 40:a.preventDefault();a=b[b.length-1];d=c.indexOf(a)+d;d>c.length-1?d=c.length-1:0>d&&(d=0);this.data.select.options[d].disabled||(this.reset(!0),this.select(d),this._scrollTo(d));break;case 32:if(!this.isOpen){a.preventDefault();this.open();break}case 9:case 13:for(d=0;d<c.length;d++)e.hasClass(c[d],
"dk-option-highlight")&&this.select(d);case 27:this.isOpen&&(a.preventDefault(),this.close())}},_searchOptions:function(a){var b=this;a=String.fromCharCode(a.keyCode||a.which);this.data.searchString===q&&(this.data.searchString="");(function(){b.data.searchTimeout&&clearTimeout(b.data.searchTimeout);b.data.searchTimeout=setTimeout(function(){b.data.searchString=""},1E3)})();this.data.searchString+=a;a=this.search(this.data.searchString,this.data.settings.search);a.length&&(e.hasClass(a[0],"dk-option-disabled")||
this.selectOne(a[0]))},_scrollTo:function(a){var b,c,d=this.data.elem.lastChild;if(!this.isOpen&&!this.multiple)return!1;"number"===typeof a&&(a=this.item(a));b=e.position(a,d).top;c=b-d.scrollTop;c+a.offsetHeight>d.offsetHeight?(b+=a.offsetHeight,d.scrollTop=b-d.offsetHeight):0>c&&(d.scrollTop=b)}};h.build=function(a,b){var c,d,f=[],g={elem:null,options:[],selected:[]},h=function(a){var c,d,f,k=[];switch(a.nodeName){case "OPTION":c=e.create("li",{"class":"dk-option","data-value":a.value,innerHTML:a.text,
role:"option","aria-selected":"false",id:b+"-"+(a.id||a.value.replace(" ","-"))});e.addClass(c,a.className);a.disabled&&(e.addClass(c,"dk-option-disabled"),c.setAttribute("aria-disabled","true"));a.selected&&(e.addClass(c,"dk-option-selected"),c.setAttribute("aria-selected","true"),g.selected.push(c));g.options.push(this.appendChild(c));break;case "OPTGROUP":c=e.create("li",{"class":"dk-optgroup"});a.label&&c.appendChild(e.create("div",{"class":"dk-optgroup-label",innerHTML:a.label}));d=e.create("ul",
{"class":"dk-optgroup-options"});for(f=a.children.length;f--;k.unshift(a.children[f]));k.forEach(h,d);this.appendChild(c).appendChild(d)}};g.elem=e.create("div",{"class":"dk-select"+(a.multiple?"-multi":"")});c=e.create("ul",{"class":"dk-select-options",id:b+"-listbox",role:"listbox"});a.disabled&&e.addClass(g.elem,"dk-select-disabled");g.elem.id=b+(a.id?"-"+a.id:"");e.addClass(g.elem,a.className);a.multiple?(g.elem.setAttribute("tabindex",a.getAttribute("tabindex")||"0"),c.setAttribute("aria-multiselectable",
"true")):(g.elem.appendChild(e.create("div",{"class":"dk-selected",tabindex:a.tabindex||0,innerHTML:a.options[a.selectedIndex].text,id:b+"-combobox","aria-live":"assertive","aria-owns":c.id,role:"combobox"})),c.setAttribute("aria-expanded","false"));for(d=a.children.length;d--;f.unshift(a.children[d]));f.forEach(h,g.elem.appendChild(c));return g};h.onDocClick=function(a){var b,c;(b=k.getElementById(a.target.htmlFor))&&null!==(c=b.getAttribute("data-dkcacheid"))&&g[c].data.elem.focus();for(b=0;b<g.length;b++)e.closest(a.target,
g[b].data.elem)||g[b].disabled||g[b].close()};f.Dropkick=h})(window,document);