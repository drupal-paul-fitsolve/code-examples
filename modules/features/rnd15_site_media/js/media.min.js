/*!
 * jQuery MediaElementJS Wrapper for rnd15
 * 
 * @author Jeremy P.
 * @date 9th Jan 2015
 */
(function(b){function c(a,c){this.$element=b(a);this.options=b.extend({},d,c);this._defaults=d;this._name="mediaVideo";this.init()}var d={played:0,type:"inline",rowSelector:".cr-content-region",mediaElementOptions:{alwaysShowControls:!1,iPadUseNativeControls:!0,iPhoneUseNativeControls:!0,AndroidUseNativeControls:!0,plugins:["youtube"],loop:!1,youTubePlayerVars:{autoplay:1,loop:0,modestbranding:1,playsinline:0,showinfo:0}}};c.prototype={init:function(){this.videoId=(this.youTubeUrl=this.$element.attr("href"))?
youtube_parser(this.youTubeUrl):"";this.cssRowId="media-video-"+this.videoId+"-"+Math.floor(1E4*Math.random());this.$videoElement=b("video",this.$element);this.$videoElement.length&&this.$videoElement.removeAttr("controls").height(0).attr("height","0");switch(this.options.type){case "row":this.setupPlayerInRow();break;case "inline":this.$startFrame=b("span[data-picture]",this.$element),this.$playButton=b(".media-video__overlay-button",this.$element)}this.$element.on("click",{plugin:this},this.handleElementClick)},
initPlayer:function(){this.$videoElement.attr("controls","controls").height("100%").attr("height","100%");this.suppressAutoInteractions();switch(this.options.type){case "inline":this.hideStartFrame();break;case "row":this.displayPlayerInRow()}this.options.mediaElementOptions.success=this.mediaElementJsSuccess;"undefined"==typeof this.player&&(this.$videoElement.mediaelementplayer(this.options.mediaElementOptions),this.player=this.$videoElement[0].player)},mediaElementJsSuccess:function(a,b){a.addEventListener("loadedmetadata",
mediaTrackVideo,!1);a.addEventListener("play",mediaTrackVideo,!1);a.addEventListener("playing",mediaTrackVideo,!1);a.addEventListener("pause",mediaTrackVideo,!1);a.addEventListener("ended",mediaTrackVideo,!1);a.addEventListener("timeupdate",mediaTrackVideo,!1)},suppressAutoInteractions:function(){if("undefined"!==typeof Drupal.settings.flexslider&&"undefined"!==typeof Drupal.settings.flexslider.instances)for(var a in Drupal.settings.flexslider.instances){if("undefined"==typeof b("#"+a).flexslider)break;
b("#"+a).flexslider("pause")}},hideStartFrame:function(){this.$startFrame.length&&this.$startFrame.add(this.$playButton).hide()},setupPlayerInRow:function(){var a=this.$element.parents(this.options.rowSelector);this.$row=b(a[a.length-1]);a=this.$element.attr("href");this.$row.prepend('<div class="media-video-row__wrapper" id="'+this.cssRowId+'"><div class="container media-video-row__container"><div class="row media-video-row media-video-row--vertically-centred"><div class="col-xs-12 media-video-row__pane">'+
('<div class="media-video"><div class="media-video__content mejs-wrapper"><button class="media-video-row__btn-close btn icon icon--large icon-close-cross"><span>Close</span></button><video width="100%" height="100%"><source type="video/youtube" src="'+a+'"></video></div></div>')+'</div></div></div><div class="media-video-row__bg"></div></div>');this.$mediaVideoRowWrapper=b("#"+this.cssRowId+".media-video-row__wrapper",this.$row);this.$videoElement=b("video",this.$mediaVideoRowWrapper);this.$mediaVideoRowBackground=
b(".media-video-row__bg",this.$mediaVideoRowWrapper);this.$mediaVideoRowCloseButton=b(".media-video-row__btn-close",this.$mediaVideoRowWrapper)},displayPlayerInRow:function(){this.suppressAutoInteractions();this.$mediaVideoRowWrapper.addClass("media-video-row__wrapper--visible");this.$mediaVideoRowBackground.on("click",{plugin:this},this.handleBackgroundClick);this.$mediaVideoRowCloseButton.on("click",{plugin:this},this.handleCloseButtonClick);b(document).on("mediaelementjs.before.enterfullscreen",
this.handleMeJSEnterFullScreen);b(document).on("mediaelementjs.before.exitfullscreen",this.handleMeJSExitFullScreen)},hidePlayerInRow:function(){this.$mediaVideoRowWrapper.removeClass("media-video-row__wrapper--visible");this.$mediaVideoRowBackground.off("click",this.handleBackgroundClick);this.$mediaVideoRowCloseButton.off("click",this.handleCloseButtonClick);b(document).off("mediaelementjs.before.enterfullscreen",this.handleMeJSEnterFullScreen);b(document).off("mediaelementjs.before.exitfullscreen",
this.handleMeJSExitFullScreen);this.player.pause()},handleElementClick:function(a){a.data.plugin.initPlayer();a.preventDefault()},handleBackgroundClick:function(a){a.data.plugin.hidePlayerInRow();a.preventDefault()},handleCloseButtonClick:function(a){a.data.plugin.hidePlayerInRow();a.preventDefault()},handleMeJSEnterFullScreen:function(a){"undefined"!=typeof a.mejs&&b(a.mejs.container).parents(".media-video-row").removeClass("media-video-row--vertically-centred")},handleMeJSExitFullScreen:function(a){"undefined"!=
typeof a.mejs&&b(a.mejs.container).parents(".media-video-row").addClass("media-video-row--vertically-centred")}};b.fn.mediaVideo=function(a){return this.each(function(){if("string"===typeof a){var d=Array.prototype.slice.call(arguments,1),e=b.data(this,"plugin_mediaVideo");e[a].apply(e,d)}else b.data(this,"plugin_mediaVideo")||b.data(this,"plugin_mediaVideo",new c(this,a))})}})(jQuery);
var mediaTrackVideo=function(b){if(dataLayer){var c=b.target.pluginApi,d=c.getVideoData(),d=d.video_id+":"+d.title,a=b.type;switch(b.type){case "play":b.target.playCount="undefined"===typeof b.target.playCount?0:b.target.playCount+1;0===b.target.playCount&&(a="playfirst");break;case "timeupdate":if(a=1.5>=c.getDuration()-c.getCurrentTime()?1:(Math.floor(c.getCurrentTime()/c.getDuration()*4)/4).toFixed(2),!c.lastP||a>c.lastP)c.lastP=a,a=100*a+"%";else return}dataLayer.push({event:"rnd15.video",label:d,
action:a,mejs:b.target,youtubeObject:c})}};function youtube_parser(b){if((b=b.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/))&&11==b[7].length)return b[7];"undefined"!==typeof console.log&&console.log("Could not retrieve Video ID from YouTube URL")};